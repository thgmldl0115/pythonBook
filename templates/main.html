{% extends 'top-footer.html' %}
{% block content %}

<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">{{ userNm }}'s BookBoard</h1>
    </div>

    <!-- Content Row -->
    <div class="row">

        <!-- Content Column -->
        <div class="col-lg-6 mb-4">

            <!-- Approach -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <div class="row">
                        <div class="col-8">
                            <h6 class="m-0 font-weight-bold text-primary" style="padding-top:.7rem;">독서 기록 추가</h6>
                        </div>
                        <div class="col-4">
                            <a href="/goals">
                            <button type="button" class="btn btn-primary btn-user btn-block" style="float:right;">
                                목표 도서 추가
                            </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form action="/addBookRecord" method="post">

                        <div id="mylist"></div>
                        <hr>
                        <div class="mb-3">
                            <label class="form-label" for="readDate">읽은 날짜</label>
                            <input class="form-control" type="date" id="readDate" name="readDate">
                        </div>
                        <div class="mb-3">
                          <label class="form-label" for="readPage">읽은 페이지 수</label>
                          <input class="form-control" type="number" id="readPage" name="today-page">

                        </div>

                        <button type="submit" class="btn btn-primary btn-user btn-block">
                            <i class="fas fa-plus fa-sm text-white-50"></i> &nbsp;독서 기록 추가하기
                        </button>

                    </form>
                </div>
            </div>

        </div>

        <div class="col-lg-6 mb-4">

            <!-- Content Row -->
            <div class="row">

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        올해 읽은 페이지 수</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="yrpage"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fa fa-book-open fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-danger shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                        올해 책사는데 쓴 돈</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="yrmoney"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fa fa-won-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">올해 책 읽은 날
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="yrdt"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fa fa-calendar-check fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Requests Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        올해 읽은 책</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="yrbook"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-list fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Earnings (Monthly) Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        마지막으로 읽은 날
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="lastday"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fa fa-calendar-day fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Requests Card Example -->
                <div class="col-xl-6 col-md-6 mb-4">
                    <div class="card border-left-dark shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                        마지막으로 읽은 책</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="lastbook"></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-bookmark fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>


    </div>

    <!-- Content Row -->

    <div class="row">

        <!-- Area Chart -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">누적 페이지 그래프</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <figure class="highcharts-figure">
                        <div id="chart01"></div>
                    </figure>
                </div>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">장르별 비율</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <figure class="highcharts-figure">
                        <div id="chart02" style="margin=1rem;"></div>
                    </figure>
                </div>
            </div>
        </div>
    </div>



</div>

<!-- /.container-fluid -->

<script>
    $(document).ready(function(){

            var yrmoney = {{ yrmoney|tojson }}[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            $("#yrmoney").text(yrmoney+'원');

            var yrs = {{ yrs|tojson }};
            if(yrs[0] != null){
                var yrpage = yrs[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }else{
                var yrpage = '0';
            }
            var yrbook = yrs[1];
            var yrdt = yrs[2];
            $("#yrpage").text(yrpage+'쪽');
            $("#yrbook").text(yrbook+'권');
            $("#yrdt").text(yrdt+'일');

            var lasts = {{ lasts|tojson }};
            if(lasts != null){
                var lastday = lasts[0];
                var lastbook = lasts[1];
            }else{
                var lastday = '00000000';
                var lastbook = '없음';
            }
            $("#lastday").text(lastday.substr(0,4)+'년 '+lastday.substr(4,2)+'월 '+lastday.substr(6,2)+'일');
            $("#lastbook").text(lastbook);

            var mylists = {{ mylists|tojson }};
            $("#mylist").empty();
            let str = "";
            for(const book of mylists){
                str += '<div class="form-check" style="margin-bottom:0.5rem;">';
                str += '<input class="form-check-input" type="radio" name="mybook" value="';
                str +=  book[2]+ '" id="' + book[2] + '" >';
                str += '<label class="form-check-label" for="'+ book[2] +'">';
                str +=  book[0] + ' (' + book[1].replaceAll('^', ', ') + ')';
                str +=  ' [' + book[3] + 'p/' + book[4] + 'p], 남은 페이지 : ' + book[5] + 'p';
                str += '</label></div>';
            }
            $("#mylist").append(str);

            var mday = {{ mday|tojson }};
            var mpage = {{ mpage|tojson }};

            var chart = Highcharts.chart('chart01', {
                credits: {enabled: false},
                title: { text: '' },
                yAxis: {
                    title: { text: '' }
                },
                xAxis: {
                    categories: mday,
                    crosshair: true
                },
                series: mpage,
                legend: {
                    layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle'
                }
            });

            var piedata = {{ piedata|tojson }};

            var pdata = []
            for(let i=0; i<piedata.length; i++){
                pdata[i] = {'name' : piedata[i][0], 'y': piedata[i][1] }
            }

            var chart = Highcharts.chart('chart02', {
                chart: {
                  renderTo: 'dounutChart',
                  type: 'pie',
                  margin: [5, 5, 5, 5],
                },
                credits: {enabled: false},
                title: { text: '' },
                series: [{
                    type: 'pie',
                    name:'권 수',
                    innerSize: '50%',
                    data: pdata,
                    dataLabels: {
                      enabled: true,
                      format: '<span class="d-label">{point.name}</span> : {y}',
                      align: 'center',
                    }
                }],
                legend: {
                    layout: 'vertical',
                    align: 'center',
                    verticalAlign: 'middle'
                }
            });


    });

</script>

{% endblock %}

